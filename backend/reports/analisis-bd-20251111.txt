ğŸš€ Iniciando anÃ¡lisis de base de datos...

âœ… Conectado a MongoDB

ğŸ“¥ Recopilando informaciÃ³n de las colecciones...

   âœ“ Usuario analizado
   âœ“ Empresa analizado
   âœ“ UsuarioEmpresa analizado
   âœ“ Cliente analizado
   âœ“ AdminUser analizado
   âœ“ ContactoEmpresa analizado
   âœ“ ConversationState analizado


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š ESTADÃSTICAS DE COLECCIONES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ ColecciÃ³n: Usuario
   ğŸ“ˆ Documentos: 0
   ğŸ”‘ Ãndices: 4

ğŸ“¦ ColecciÃ³n: Empresa
   ğŸ“ˆ Documentos: 0
   ğŸ”‘ Ãndices: 3

ğŸ“¦ ColecciÃ³n: UsuarioEmpresa
   ğŸ“ˆ Documentos: 0
   ğŸ”‘ Ãndices: 7

ğŸ“¦ ColecciÃ³n: Cliente
   ğŸ“ˆ Documentos: 0
   ğŸ”‘ Ãndices: 6

ğŸ“¦ ColecciÃ³n: AdminUser
   ğŸ“ˆ Documentos: 0
   ğŸ”‘ Ãndices: 4

ğŸ“¦ ColecciÃ³n: ContactoEmpresa
   ğŸ“ˆ Documentos: 0
   ğŸ”‘ Ãndices: 8

ğŸ“¦ ColecciÃ³n: ConversationState
   ğŸ“ˆ Documentos: 0
   ğŸ”‘ Ãndices: 5

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ—ï¸  ESTRUCTURA DE SCHEMAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Schema: Usuario
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   numero: String âœ“required ğŸ”indexed
   nombre: String
   empresaId: String âœ“required ğŸ”indexed
   empresaTelefono: String âœ“required
   historial: [String]
   interacciones: Number
   ultimaInteraccion: String
   ultima_actualizacion: String
   saludado: Boolean
   despedido: Boolean
   ultima_saludo: String
   resumen: String
   num_mensajes_enviados: Number
   num_mensajes_recibidos: Number
   num_media_recibidos: Number
   mensaje_ids: [String]
   ultimo_status: String
   tokens_consumidos: Number
   contactoInformado: Boolean

ğŸ“ Schema: Empresa
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   nombre: String âœ“required âš¡unique ğŸ”indexed
   categoria: String âœ“required
   telefono: String âœ“required âš¡unique ğŸ”indexed
   email: Mixed
   derivarA: Mixed
   prompt: String âœ“required
   saludos: Mixed
   catalogoPath: String âœ“required
   linkCatalogo: Mixed
   modelo: String
   ubicaciones: Mixed
   phoneNumberId: Mixed
   plan: String
   modulos: Mixed
   limites: Mixed
   uso: Mixed
   facturacion: Mixed

ğŸ“ Schema: UsuarioEmpresa
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   username: String âœ“required âš¡unique ğŸ”indexed
   password: String âœ“required
   email: String âœ“required ğŸ”indexed
   nombre: String âœ“required
   apellido: String
   empresaId: String âœ“required ğŸ”indexed
   rol: String âœ“required
   permisos: [String]
   activo: Boolean
   avatar: String
   telefono: String
   ultimoAcceso: Date
   createdBy: String âœ“required

ğŸ“ Schema: Cliente
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   empresaId: String âœ“required ğŸ”indexed
   nombre: String âœ“required
   apellido: String âœ“required
   email: String
   telefono: String âœ“required
   direccion: String
   ciudad: String
   provincia: String
   codigoPostal: String
   fechaNacimiento: Date
   dni: String
   notas: String
   sector: String
   origen: String âœ“required
   chatbotUserId: String ğŸ”indexed
   profileName: String
   preferencias: [object Object]
   activo: Boolean
   creadoEn: Date
   actualizadoEn: Date

ğŸ“ Schema: AdminUser
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   username: String âœ“required âš¡unique ğŸ”indexed
   password: String âœ“required
   empresaId: String âœ“required ğŸ”indexed
   role: String
   email: String
   activo: Boolean
   ultimoAcceso: Date

ğŸ“ Schema: ContactoEmpresa
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   empresaId: String âœ“required ğŸ”indexed
   telefono: String âœ“required ğŸ”indexed
   nombre: String âœ“required
   apellido: String âœ“required
   email: String
   profileName: String
   direccion: String
   ciudad: String
   provincia: String
   codigoPostal: String
   fechaNacimiento: Date
   dni: String
   sector: String
   notas: String
   origen: String âœ“required
   preferencias: [object Object]
   conversaciones: [object Object]
   metricas: [object Object]
   activo: Boolean

ğŸ“ Schema: ConversationState
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   telefono: String âœ“required ğŸ”indexed
   empresaId: String âœ“required ğŸ”indexed
   flujo_activo: String
   estado_actual: String
   data: SchemaMixed
   flujos_pendientes: [String]
   prioridad: String
   pausado: Boolean
   ultima_interaccion: Date

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”— RELACIONES DETECTADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ Usuario:
   â””â”€> empresa (via empresaId)

ğŸ“Œ Empresa:
   â””â”€> phoneNumber (via phoneNumberId)

ğŸ“Œ UsuarioEmpresa:
   â””â”€> empresa (via empresaId)

ğŸ“Œ Cliente:
   â””â”€> empresa (via empresaId)
   â””â”€> chatbotUser (via chatbotUserId)

ğŸ“Œ AdminUser:
   â””â”€> empresa (via empresaId)

ğŸ“Œ ContactoEmpresa:
   â””â”€> empresa (via empresaId)

ğŸ“Œ ConversationState:
   â””â”€> empresa (via empresaId)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” ÃNDICES DE BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‡ Usuario:
   â€¢ _id_: {}
   â€¢ numero_1: {}
   â€¢ empresaId_1: {}
   â€¢ numero_1_empresaId_1: {}

ğŸ“‡ Empresa:
   â€¢ _id_: {}
   â€¢ nombre_1: {}
   â€¢ telefono_1: {}

ğŸ“‡ UsuarioEmpresa:
   â€¢ _id_: {}
   â€¢ username_1: {}
   â€¢ email_1: {}
   â€¢ empresaId_1: {}
   â€¢ username_1_empresaId_1: {}
   â€¢ email_1_empresaId_1: {}
   â€¢ empresaId_1_activo_1: {}

ğŸ“‡ Cliente:
   â€¢ _id_: {}
   â€¢ empresaId_1: {}
   â€¢ chatbotUserId_1: {}
   â€¢ empresaId_1_telefono_1: {}
   â€¢ empresaId_1_email_1: {}
   â€¢ empresaId_1_activo_1: {}

ğŸ“‡ AdminUser:
   â€¢ _id_: {}
   â€¢ username_1: {}
   â€¢ empresaId_1: {}
   â€¢ username_1_empresaId_1: {}

ğŸ“‡ ContactoEmpresa:
   â€¢ _id_: {}
   â€¢ empresaId_1: {}
   â€¢ telefono_1: {}
   â€¢ empresaId_1_telefono_1: {}
   â€¢ empresaId_1_email_1: {}
   â€¢ empresaId_1_activo_1: {}
   â€¢ empresaId_1_sector_1: {}
   â€¢ metricas.ultimaInteraccion_1: {}

ğŸ“‡ ConversationState:
   â€¢ _id_: {}
   â€¢ telefono_1: {}
   â€¢ empresaId_1: {}
   â€¢ telefono_1_empresaId_1: {}
   â€¢ ultima_interaccion_1: {}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š DIAGRAMA MERMAID (Copiar en mermaid.live)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

```mermaid
erDiagram
  Usuario {
    string numero
    string nombre
    string empresaId
    string empresaTelefono
    string historial
    number interacciones
    string ultimaInteraccion
    string ultima_actualizacion
  }
  Empresa {
    string nombre
    string categoria
    string telefono
    string email
    string derivarA
    string prompt
    string saludos
    string catalogoPath
  }
  UsuarioEmpresa {
    string username
    string password
    string email
    string nombre
    string apellido
    string empresaId
    string rol
    string permisos
  }
  Cliente {
    string empresaId
    string nombre
    string apellido
    string email
    string telefono
    string direccion
    string ciudad
    string provincia
  }
  AdminUser {
    string username
    string password
    string empresaId
    string role
    string email
    boolean activo
    date ultimoAcceso
  }
  ContactoEmpresa {
    string empresaId
    string telefono
    string nombre
    string apellido
    string email
    string profileName
    string direccion
    string ciudad
  }
  ConversationState {
    string telefono
    string empresaId
    string flujo_activo
    string estado_actual
    schemamixed data
    string flujos_pendientes
    string prioridad
    boolean pausado
  }

  Usuario ||--o{ Eempresa : "empresaId"
  Empresa ||--o{ PphoneNumber : "phoneNumberId"
  UsuarioEmpresa ||--o{ Eempresa : "empresaId"
  Cliente ||--o{ Eempresa : "empresaId"
  Cliente ||--o{ CchatbotUser : "chatbotUserId"
  AdminUser ||--o{ Eempresa : "empresaId"
  ContactoEmpresa ||--o{ Eempresa : "empresaId"
  ConversationState ||--o{ Eempresa : "empresaId"
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ RECOMENDACIONES PARA MARKETPLACE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ Para el mÃ³dulo de Marketplace, recomiendo:

1ï¸âƒ£  Crear modelo: MarketplaceIntegration
   Campos clave:
   â€¢ usuarioEmpresaId: ObjectId (ref: UsuarioEmpresa)
   â€¢ empresaId: string (ref: Empresa.nombre)
   â€¢ provider: string (google_calendar, outlook, etc.)
   â€¢ credentials: { access_token, refresh_token, expires_at }
   â€¢ status: string (active, expired, revoked)

2ï¸âƒ£  Relaciones identificadas:
   â€¢ Empresa usa: "String" como ID Ãºnico
   â€¢ UsuarioEmpresa referencia Empresa via: "empresaId"

3ï¸âƒ£  Consideraciones de seguridad:
   â€¢ Encriptar tokens OAuth en la BD
   â€¢ Almacenar client_id y client_secret en .env
   â€¢ Implementar refresh automÃ¡tico de tokens

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… AnÃ¡lisis completado exitosamente
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”Œ ConexiÃ³n cerrada

