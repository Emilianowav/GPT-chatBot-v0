# ğŸ“Š FLUJOS INTERCAPITAL - CHATBOT WHATSAPP

## ğŸ¯ MENÃš PRINCIPAL

**Trigger:** Keywords `hola`, `menu`, `inicio`, `intercapital`, `ayuda`

```
ğŸ‘‹ Â¡Bienvenido a Intercapital!
Soy tu asistente virtual para operaciones bursÃ¡tiles.

ğŸ‘‰ Â¿QuÃ© operaciÃ³n deseas realizar?

1ï¸âƒ£ Comprar activos
2ï¸âƒ£ Vender activos
3ï¸âƒ£ Solicitar retiro
4ï¸âƒ£ Consultar mis Ã³rdenes
5ï¸âƒ£ Ayuda

EscribÃ­ el nÃºmero
```

---

## ğŸ“ˆ FLUJO 1: COMPRAR ACTIVOS

### Pasos:

1. **Solicitar Comitente**
   - Pregunta: "ğŸ”¢ Por favor, ingresa tu nÃºmero de comitente:"
   - ValidaciÃ³n: NÃºmero mayor a 0

2. **Validar Comitente** (API)
   - Endpoint: `GET /usuarios/validate?comitente={comitente}`
   - Si no existe: Mensaje de error + volver al menÃº
   - Si existe: "âœ… Hola {nombre}! Tu cuenta estÃ¡ activa"

3. **Solicitar SÃ­mbolo**
   - Pregunta: "ğŸ“Š Â¿QuÃ© activo deseas comprar? (ej: AL30, GGAL)"
   - ValidaciÃ³n: Texto 2-10 caracteres

4. **Solicitar Cantidad**
   - Pregunta: "ğŸ“¦ Â¿CuÃ¡ntas unidades deseas comprar?"
   - ValidaciÃ³n: NÃºmero mayor a 0

5. **Solicitar Precio**
   - Pregunta: "ğŸ’° Â¿A quÃ© precio deseas comprar? (precio por unidad)"
   - ValidaciÃ³n: NÃºmero mayor a 0.01

6. **ConfirmaciÃ³n**
   - Muestra resumen completo
   - Opciones: 1 (Confirmar) / 2 (Cancelar)

7. **Crear Orden** (API)
   - Endpoint: `POST /ordenes`
   - Body: comitente, operacion=COMPRA, symbol, cantidad, precio
   - Respuesta: Orden creada con nÃºmero y estado

---

## ğŸ“‰ FLUJO 2: VENDER ACTIVOS

### Pasos:

IdÃ©ntico al flujo de compra, pero con `operacion: VENTA`

1. Solicitar Comitente
2. Validar Comitente (API)
3. Solicitar SÃ­mbolo
4. Solicitar Cantidad
5. Solicitar Precio
6. ConfirmaciÃ³n
7. Crear Orden (API) con operacion=VENTA

---

## ğŸ’µ FLUJO 3: SOLICITAR RETIRO

### Pasos:

1. **Solicitar Comitente**
   - Pregunta: "ğŸ”¢ Por favor, ingresa tu nÃºmero de comitente:"
   - ValidaciÃ³n: NÃºmero mayor a 0

2. **Validar Comitente** (API)
   - Endpoint: `GET /usuarios/validate?comitente={comitente}`
   - Si no existe: Mensaje de error + volver al menÃº
   - Si existe: "âœ… Hola {nombre}! Procedamos con tu retiro"

3. **Solicitar Monto**
   - Pregunta: "ğŸ’µ Â¿QuÃ© monto deseas retirar? (en pesos)"
   - ValidaciÃ³n: NÃºmero mayor a 0

4. **Solicitar CBU**
   - Pregunta: "ğŸ¦ Ingresa el CBU de destino (22 dÃ­gitos)"
   - ValidaciÃ³n: Texto exactamente 22 caracteres
   - Advertencia: Verificar que el CBU sea correcto

5. **ConfirmaciÃ³n**
   - Muestra: Comitente, Nombre, Monto, CBU
   - Opciones: 1 (Confirmar) / 2 (Cancelar)

6. **Crear Solicitud** (API)
   - Endpoint: `POST /ordenes`
   - Body: comitente, operacion=RETIRO, symbol=PESOS, cantidad=monto, precio=1, cbu_destino
   - Respuesta: Solicitud creada con nÃºmero y estado
   - Nota: Procesamiento en 24-48hs hÃ¡biles

---

## ğŸ“‹ FLUJO 4: CONSULTAR Ã“RDENES

### Pasos:

1. **Solicitar Comitente**
   - Pregunta: "ğŸ”¢ Por favor, ingresa tu nÃºmero de comitente:"
   - ValidaciÃ³n: NÃºmero mayor a 0

2. **Validar Comitente** (API)
   - Endpoint: `GET /usuarios/validate?comitente={comitente}`
   - Si no existe: Mensaje de error + volver al menÃº
   - Si existe: "âœ… Hola {nombre}! Consultando tus Ã³rdenes..."

3. **Listar Ã“rdenes** (API)
   - Endpoint: `GET /ordenes?comitente={comitente}&limit=10`
   - Si no hay Ã³rdenes: "ğŸ“‹ No tienes Ã³rdenes registradas"
   - Si hay Ã³rdenes: Lista numerada con formato:
     ```
     1. Orden #1234 - COMPRA 100 AL30 - Estado: PENDIENTE
     2. Orden #1235 - VENTA 50 GGAL - Estado: APROBADA
     ```
   - OpciÃ³n: Seleccionar orden para ver detalles o 0 para volver

---

## â„¹ï¸ FLUJO 5: AYUDA

### Contenido:

```
â„¹ï¸ AYUDA - Intercapital Bot

Â¿QuÃ© puedes hacer?

1ï¸âƒ£ Comprar activos
   Crea Ã³rdenes de compra de acciones, bonos, cedears, etc.

2ï¸âƒ£ Vender activos
   Crea Ã³rdenes de venta de tus activos.

3ï¸âƒ£ Solicitar retiros
   Solicita transferencias a tu cuenta bancaria.

4ï¸âƒ£ Consultar Ã³rdenes
   Revisa el estado de tus operaciones.

InformaciÃ³n importante:
â€¢ Todas las Ã³rdenes quedan PENDIENTES de aprobaciÃ³n
â€¢ Nuestro equipo las procesarÃ¡ en horario de mercado
â€¢ RecibirÃ¡s notificaciones de cambios de estado

Â¿Necesitas ayuda personalizada?
ğŸ“ TelÃ©fono: 0800-XXX-XXXX
ğŸ“§ Email: soporte@intercapital.com.ar

EscribÃ­ 1 para volver al menÃº principal
```

---

## ğŸ”„ COMPORTAMIENTO GENERAL

### Auto-reinicio al MenÃº
- Al completar cualquier flujo, el bot automÃ¡ticamente vuelve al menÃº principal
- El usuario no necesita escribir "hola" nuevamente

### ValidaciÃ³n de Comitente
- Todos los flujos validan el comitente antes de continuar
- Si el comitente no existe o no puede operar, se muestra error y vuelve al menÃº

### Estados de Ã“rdenes
- **PENDIENTE**: Orden creada, esperando aprobaciÃ³n
- **APROBADA**: Orden aprobada por el equipo
- **RECHAZADA**: Orden rechazada
- **EJECUTADA**: Orden ejecutada exitosamente

### CancelaciÃ³n
- En cualquier paso de confirmaciÃ³n, el usuario puede cancelar con opciÃ³n "2"
- Al cancelar, vuelve automÃ¡ticamente al menÃº principal

---

## ğŸ”§ CONFIGURACIÃ“N TÃ‰CNICA

### Endpoints Utilizados

1. **Validar Usuario**
   - `GET /usuarios/validate?comitente={comitente}`
   - Headers: `x-api-key`

2. **Crear Orden**
   - `POST /ordenes`
   - Headers: `x-api-key`, `Content-Type: application/json`
   - Body: comitente, operacion, symbol, cantidad, precio, cbu_destino (opcional)

3. **Consultar Orden**
   - `GET /ordenes/{ordenId}`
   - Headers: `x-api-key`

4. **Listar Ã“rdenes**
   - `GET /ordenes?comitente={comitente}&limit=10`
   - Headers: `x-api-key`

### Variables de Entorno Requeridas

```bash
INTERCAPITAL_API_URL=https://app1.intercapital.ar/api/chatbot
INTERCAPITAL_API_KEY=2e590cf1f4fd1144f1ce0622347c046a0fa3e2bd786114273094049b6cd55c0a
```

---

## ğŸ§ª TESTING

### Script de Setup
```bash
node scripts/setup-intercapital.js
```

### Script de Testing
```bash
node scripts/test-intercapital.js
```

### Limpiar Estado
```bash
node scripts/limpiar-estado-intercapital.js
```

### Flujo de Testing Manual

1. Escribir "hola" o "intercapital" en WhatsApp
2. Seleccionar opciÃ³n del menÃº
3. Seguir el flujo paso a paso
4. Verificar que la orden se cree correctamente
5. Verificar que vuelva al menÃº automÃ¡ticamente

---

## âš ï¸ NOTAS IMPORTANTES

1. **Todas las Ã³rdenes quedan PENDIENTES** - Requieren aprobaciÃ³n manual del equipo
2. **ValidaciÃ³n de comitente es obligatoria** - No se pueden crear Ã³rdenes sin validar
3. **CBU debe tener 22 dÃ­gitos** - ValidaciÃ³n estricta para retiros
4. **Precios en pesos** - Todos los montos son en pesos argentinos
5. **Horario de mercado** - Las Ã³rdenes se procesan en horario de mercado
6. **Retiros en 24-48hs** - Los retiros se procesan en dÃ­as hÃ¡biles

---

## ğŸ“ SOPORTE

Para problemas tÃ©cnicos o consultas:
- **Email:** soporte@intercapital.com.ar
- **TelÃ©fono:** 0800-XXX-XXXX
- **Horario:** Lunes a Viernes 9:00 - 18:00hs
