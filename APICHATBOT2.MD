# ğŸ“˜ DOCUMENTACIÃ“N COMPLETA - API CHATBOT WHATSAPP
## ConfiguraciÃ³n Render + IntegraciÃ³n Chatbot

---

## ğŸ¯ RESUMEN EJECUTIVO

La API del chatbot ha sido **completamente implementada** en el backend de Intercapital. Este documento contiene:

1. âœ… Instrucciones de configuraciÃ³n en Render
2. âœ… DocumentaciÃ³n completa de la API para el equipo del chatbot
3. âœ… Flujos de integraciÃ³n y casos de uso
4. âœ… Ejemplos de cÃ³digo y testing

---

## ğŸ“¦ ARCHIVOS CREADOS

### Backend (`/var/www/intercapital/back/`)

#### Modelos
- âœ… `src/models/ada/ChatbotApiKey.js` - GestiÃ³n de API keys
- âœ… `src/models/ada/ChatbotLog.js` - AuditorÃ­a de requests
- âœ… `src/models/ada/index.js` - **ACTUALIZADO** (exports agregados)

#### Middlewares
- âœ… `src/middleware/chatbotAuth.middleware.js` - AutenticaciÃ³n con API key
- âœ… `src/middleware/chatbotRateLimit.js` - Rate limiting
- âœ… `src/middleware/chatbotLogger.middleware.js` - Logging de auditorÃ­a

#### Services
- âœ… `src/services/chatbot.service.js` - LÃ³gica de negocio
- âœ… `src/services/chatbot.validation.service.js` - Validaciones

#### Controllers y Routes
- âœ… `src/controllers/chatbot.controller.js` - Controladores
- âœ… `src/routes/chatbot.routes.js` - Rutas de la API

#### Scripts de GestiÃ³n
- âœ… `src/scripts/create-chatbot-apikey.js` - Crear API keys
- âœ… `src/scripts/list-chatbot-apikeys.js` - Listar API keys
- âœ… `src/scripts/revoke-chatbot-apikey.js` - Revocar API keys

#### ConfiguraciÃ³n
- âœ… `src/app.js` - **ACTUALIZADO** (ruta chatbot agregada)
- âœ… `.env` - **ACTUALIZADO** (variables agregadas)

---

## ğŸš€ PASOS DE DESPLIEGUE

### 1. Reiniciar el Backend

```bash
# Conectarse al VPS
ssh root@62.72.63.166

# Ir al directorio del backend
cd /var/www/intercapital/back

# Reiniciar el servicio con PM2
pm2 restart intercapital-new-api

# Verificar que estÃ© corriendo
pm2 logs intercapital-new-api --lines 50
```

### 2. Crear las Tablas en la Base de Datos

Las tablas se crearÃ¡n automÃ¡ticamente al iniciar el backend gracias a Sequelize. Verifica en los logs:

```bash
pm2 logs intercapital-new-api | grep chatbot
```

DeberÃ­as ver:
```
âœ… Tabla chatbot_api_keys creada
âœ… Tabla chatbot_logs creada
```

### 3. Generar Primera API Key

```bash
cd /var/www/intercapital/back
node src/scripts/create-chatbot-apikey.js
```

**Salida esperada:**
```
âœ… Conectado a la base de datos
âœ… API Key creada exitosamente

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ID: 123e4567-e89b-12d3-a456-426614174000
Nombre: WhatsApp Bot Principal
Scopes: ordenes:create, ordenes:read, ordenes:list, usuarios:read, usuarios:validate
Rate Limit: 100 req/min
Creado por: admin
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸  IMPORTANTE: Guarda esta API key, no se mostrarÃ¡ nuevamente:

   a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**âš ï¸ IMPORTANTE:** Guarda la API key en un lugar seguro (1Password, Bitwarden, etc.)

### 4. Verificar que la API Funciona

```bash
# Health check (sin autenticaciÃ³n)
curl https://app1.intercapital.ar/api/chatbot/health

# Respuesta esperada:
{
  "status": "OK",
  "service": "chatbot-api",
  "timestamp": "2026-01-02T12:00:00.000Z",
  "version": "1.0.0"
}
```

---

## ğŸ”§ CONFIGURACIÃ“N EN RENDER

### Variables de Entorno a Configurar

En el dashboard de Render, agregar las siguientes variables de entorno para el servicio del chatbot de WhatsApp:

```bash
# URL de la API de Intercapital
INTERCAPITAL_API_URL=https://app1.intercapital.ar/api/chatbot

# API Key generada en el paso 3
INTERCAPITAL_API_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6

# ConfiguraciÃ³n opcional
INTERCAPITAL_TIMEOUT=30000
INTERCAPITAL_RETRY_ATTEMPTS=3
```

### Ejemplo de ConfiguraciÃ³n en Render

1. **Ir a tu servicio en Render**
2. **Environment** â†’ **Add Environment Variable**
3. Agregar cada variable listada arriba
4. **Save Changes**
5. El servicio se reiniciarÃ¡ automÃ¡ticamente

---

## ğŸ“¡ DOCUMENTACIÃ“N DE LA API

### Base URL
```
https://app1.intercapital.ar/api/chatbot
```

### AutenticaciÃ³n

Todas las rutas (excepto `/health`) requieren el header:

```
x-api-key: <tu_api_key>
```

### Rate Limiting

- **LÃ­mite:** 100 requests por minuto por API key
- **Respuesta cuando se excede:**
```json
{
  "success": false,
  "error": "RATE_LIMIT_EXCEEDED",
  "message": "LÃ­mite de requests excedido",
  "retry_after": 60
}
```

---

## ğŸ”Œ ENDPOINTS DISPONIBLES

### 1. Health Check

**No requiere autenticaciÃ³n**

```http
GET /api/chatbot/health
```

**Respuesta 200:**
```json
{
  "status": "OK",
  "service": "chatbot-api",
  "timestamp": "2026-01-02T12:00:00.000Z",
  "version": "1.0.0"
}
```

---

### 2. Validar Usuario

Verifica si un comitente existe y puede operar.

```http
GET /api/chatbot/usuarios/validate?comitente=12345
Headers: x-api-key: <api_key>
```

**Respuesta 200 (Usuario existe):**
```json
{
  "success": true,
  "data": {
    "comitente": 12345,
    "exists": true,
    "nombre": "Juan PÃ©rez",
    "estado": "ACTIVO",
    "puede_operar": true
  }
}
```

**Respuesta 404 (Usuario no existe):**
```json
{
  "success": false,
  "error": "USER_NOT_FOUND",
  "message": "Comitente no encontrado"
}
```

---

### 3. Obtener Datos de Usuario

Obtiene informaciÃ³n completa de un usuario.

```http
GET /api/chatbot/usuarios/:comitente
Headers: x-api-key: <api_key>
```

**Ejemplo:**
```http
GET /api/chatbot/usuarios/12345
```

**Respuesta 200:**
```json
{
  "success": true,
  "data": {
    "comitente": 12345,
    "nombre": "Juan PÃ©rez",
    "email": "juan@example.com",
    "telefono": "+5491112345678",
    "estado": "ACTIVO",
    "tipo_cuenta": "PERSONA_FISICA",
    "created_at": "2025-01-15T10:00:00.000Z"
  }
}
```

---

### 4. Crear Orden

Crea una nueva orden de compra/venta/retiro.

```http
POST /api/chatbot/ordenes
Headers: 
  Content-Type: application/json
  x-api-key: <api_key>

Body:
{
  "comitente": 12345,
  "operacion": "COMPRA",
  "symbol": "AL30",
  "cantidad": 100,
  "precio": 850.50,
  "plazo": "CONTADO",
  "tipo_orden": "MERCADO",
  "notas": "Orden desde WhatsApp",
  "metadata": {
    "whatsapp_phone": "+5491112345678",
    "conversation_id": "conv_abc123",
    "message_id": "msg_xyz789"
  }
}
```

**Campos Obligatorios:**
- `comitente` (integer): NÃºmero de comitente
- `operacion` (string): COMPRA, VENTA, RETIRO, DEPOSITO
- `symbol` (string): SÃ­mbolo del activo (AL30, GGAL, USD, etc.)
- `cantidad` (number): Cantidad de activos
- `precio` (number): Precio por unidad

**Campos Opcionales:**
- `plazo` (string): CONTADO (default), 24HS, 48HS
- `tipo_orden` (string): MERCADO (default), LIMITE
- `cbu_destino` (string): Requerido para RETIRO
- `notas` (string): Notas adicionales
- `metadata` (object): Datos del chatbot para auditorÃ­a

**Respuesta 201 (Ã‰xito):**
```json
{
  "success": true,
  "message": "Orden creada exitosamente. Estado: PENDIENTE",
  "data": {
    "id": "uuid-orden",
    "orden": 1234,
    "operacion": "COMPRA",
    "estado": "PENDIENTE",
    "symbol": "AL30",
    "plazo": "CONTADO",
    "cantidad": 100,
    "precio": 850.50,
    "monto": 85050.00,
    "comitente": 12345,
    "nombre_cliente": "Juan PÃ©rez",
    "tipo_orden": "MERCADO",
    "created_at": "2026-01-02T12:00:00.000Z"
  }
}
```

**Respuesta 400 (Error de validaciÃ³n):**
```json
{
  "success": false,
  "error": "VALIDATION_ERROR",
  "message": "Error de validaciÃ³n",
  "details": {
    "comitente": "Comitente no encontrado",
    "precio": "Precio debe ser mayor a 0"
  }
}
```

**Respuesta 403 (Usuario no puede operar):**
```json
{
  "success": false,
  "error": "OPERATION_NOT_ALLOWED",
  "message": "Usuario en estado: PENDIENTE"
}
```

---

### 5. Consultar Orden

Obtiene el detalle de una orden especÃ­fica.

```http
GET /api/chatbot/ordenes/:id
Headers: x-api-key: <api_key>
```

**Ejemplo:**
```http
GET /api/chatbot/ordenes/uuid-orden-123
```

**Respuesta 200:**
```json
{
  "success": true,
  "data": {
    "id": "uuid-orden-123",
    "orden": 1234,
    "operacion": "COMPRA",
    "estado": "APROBADA",
    "symbol": "AL30",
    "plazo": "CONTADO",
    "cantidad": 100,
    "precio": 850.50,
    "monto": 85050.00,
    "comitente": 12345,
    "nombre_cliente": "Juan PÃ©rez",
    "nombre_operador": "Facundo Franco",
    "tipo_orden": "MERCADO",
    "cbu_destino": null,
    "notas": "Orden desde WhatsApp...",
    "created_at": "2026-01-02T12:00:00.000Z",
    "updated_at": "2026-01-02T12:05:00.000Z"
  }
}
```

**Respuesta 404:**
```json
{
  "success": false,
  "error": "ORDER_NOT_FOUND",
  "message": "Orden no encontrada"
}
```

---

### 6. Listar Ã“rdenes

Lista las Ã³rdenes de un comitente con filtros opcionales.

```http
GET /api/chatbot/ordenes?comitente=12345&estado=PENDIENTE&limit=10&offset=0
Headers: x-api-key: <api_key>
```

**Query Parameters:**
- `comitente` (required): NÃºmero de comitente
- `estado` (optional): PENDIENTE, APROBADA, RECHAZADA, EJECUTADA
- `operacion` (optional): COMPRA, VENTA, RETIRO
- `limit` (optional): Cantidad de resultados (default: 10, max: 50)
- `offset` (optional): Offset para paginaciÃ³n (default: 0)

**Respuesta 200:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid-1",
      "orden": 1234,
      "operacion": "COMPRA",
      "estado": "PENDIENTE",
      "symbol": "AL30",
      "plazo": "CONTADO",
      "cantidad": 100,
      "precio": 850.50,
      "monto": 85050.00,
      "tipo_orden": "MERCADO",
      "created_at": "2026-01-02T12:00:00.000Z",
      "updated_at": "2026-01-02T12:00:00.000Z"
    }
  ],
  "pagination": {
    "total": 1,
    "limit": 10,
    "offset": 0
  }
}
```

---

## ğŸ’¬ FLUJOS DE INTEGRACIÃ“N CHATBOT

### Flujo 1: Usuario Solicita Comprar Activo

```
1. Usuario: "Quiero comprar 100 AL30"
   
2. Bot valida usuario:
   GET /api/chatbot/usuarios/validate?comitente=12345
   
3. Bot solicita confirmaciÃ³n de precio:
   "Â¿Confirmas compra de 100 AL30 a $850.50? (Total: $85,050)"
   
4. Usuario: "SÃ­, confirmo"
   
5. Bot crea la orden:
   POST /api/chatbot/ordenes
   {
     "comitente": 12345,
     "operacion": "COMPRA",
     "symbol": "AL30",
     "cantidad": 100,
     "precio": 850.50,
     "metadata": {
       "whatsapp_phone": "+5491112345678",
       "conversation_id": "conv_123"
     }
   }
   
6. Bot responde:
   "âœ… Orden #1234 creada exitosamente
   Estado: PENDIENTE
   SerÃ¡ procesada por nuestro equipo"
```

### Flujo 2: Usuario Consulta Estado de Orden

```
1. Usuario: "Â¿CÃ³mo va mi orden #1234?"
   
2. Bot consulta:
   GET /api/chatbot/ordenes/uuid-orden-1234
   
3. Bot responde segÃºn estado:
   - PENDIENTE: "Tu orden estÃ¡ pendiente de aprobaciÃ³n"
   - APROBADA: "âœ… Tu orden fue aprobada por [Operador]"
   - RECHAZADA: "âŒ Tu orden fue rechazada"
   - EJECUTADA: "âœ… Tu orden fue ejecutada exitosamente"
```

### Flujo 3: Usuario Lista Sus Ã“rdenes

```
1. Usuario: "Mostrame mis Ã³rdenes pendientes"
   
2. Bot consulta:
   GET /api/chatbot/ordenes?comitente=12345&estado=PENDIENTE&limit=5
   
3. Bot responde:
   "ğŸ“‹ Tus Ã³rdenes pendientes:
   
   1. Orden #1234 - COMPRA 100 AL30 ($85,050)
   2. Orden #1235 - VENTA 50 GGAL ($12,500)
   
   Total: 2 Ã³rdenes"
```

---

## ğŸ”’ CÃ“DIGOS DE ERROR

### Errores de AutenticaciÃ³n (401)
- `API_KEY_MISSING`: Falta el header x-api-key
- `INVALID_API_KEY`: API key invÃ¡lida o inactiva
- `API_KEY_EXPIRED`: API key expirada

### Errores de AutorizaciÃ³n (403)
- `INSUFFICIENT_SCOPE`: Permisos insuficientes
- `IP_NOT_ALLOWED`: IP no autorizada
- `OPERATION_NOT_ALLOWED`: Usuario no puede operar

### Errores de ValidaciÃ³n (400)
- `VALIDATION_ERROR`: Error en datos enviados
- `MISSING_PARAMETER`: Falta un parÃ¡metro requerido

### Errores de Recursos (404)
- `USER_NOT_FOUND`: Usuario/comitente no encontrado
- `ORDER_NOT_FOUND`: Orden no encontrada

### Errores de Rate Limiting (429)
- `RATE_LIMIT_EXCEEDED`: LÃ­mite de requests excedido

### Errores del Servidor (500)
- `INTERNAL_ERROR`: Error interno del servidor
- `AUTH_ERROR`: Error de autenticaciÃ³n
- `CREATE_ERROR`: Error al crear recurso

---

## ğŸ“ EJEMPLO DE INTEGRACIÃ“N EN NODE.JS

### Cliente HTTP BÃ¡sico

```javascript
const axios = require('axios');

class IntercapitalAPI {
  constructor(apiKey) {
    this.baseURL = 'https://app1.intercapital.ar/api/chatbot';
    this.apiKey = apiKey;
    this.client = axios.create({
      baseURL: this.baseURL,
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': this.apiKey
      },
      timeout: 30000
    });
  }

  async validarUsuario(comitente) {
    try {
      const response = await this.client.get(`/usuarios/validate`, {
        params: { comitente }
      });
      return response.data;
    } catch (error) {
      console.error('Error validando usuario:', error.response?.data);
      throw error;
    }
  }

  async crearOrden(ordenData) {
    try {
      const response = await this.client.post('/ordenes', ordenData);
      return response.data;
    } catch (error) {
      console.error('Error creando orden:', error.response?.data);
      throw error;
    }
  }

  async consultarOrden(ordenId) {
    try {
      const response = await this.client.get(`/ordenes/${ordenId}`);
      return response.data;
    } catch (error) {
      console.error('Error consultando orden:', error.response?.data);
      throw error;
    }
  }

  async listarOrdenes(comitente, filtros = {}) {
    try {
      const response = await this.client.get('/ordenes', {
        params: { comitente, ...filtros }
      });
      return response.data;
    } catch (error) {
      console.error('Error listando Ã³rdenes:', error.response?.data);
      throw error;
    }
  }
}

// Uso
const api = new IntercapitalAPI(process.env.INTERCAPITAL_API_KEY);

// Validar usuario
const usuario = await api.validarUsuario(12345);
console.log('Usuario:', usuario);

// Crear orden
const orden = await api.crearOrden({
  comitente: 12345,
  operacion: 'COMPRA',
  symbol: 'AL30',
  cantidad: 100,
  precio: 850.50,
  metadata: {
    whatsapp_phone: '+5491112345678',
    conversation_id: 'conv_123'
  }
});
console.log('Orden creada:', orden);
```

### Manejo de Errores

```javascript
async function crearOrdenSegura(api, ordenData) {
  try {
    // 1. Validar usuario primero
    const validacion = await api.validarUsuario(ordenData.comitente);
    
    if (!validacion.data.exists) {
      return {
        success: false,
        message: 'Usuario no encontrado'
      };
    }
    
    if (!validacion.data.puede_operar) {
      return {
        success: false,
        message: `Usuario no puede operar. Estado: ${validacion.data.estado}`
      };
    }
    
    // 2. Crear orden
    const resultado = await api.crearOrden(ordenData);
    return resultado;
    
  } catch (error) {
    if (error.response) {
      // Error de la API
      const { status, data } = error.response;
      
      if (status === 401) {
        return {
          success: false,
          message: 'Error de autenticaciÃ³n. Verifica tu API key.'
        };
      }
      
      if (status === 429) {
        return {
          success: false,
          message: 'LÃ­mite de requests excedido. Intenta en 1 minuto.'
        };
      }
      
      if (status === 400 && data.error === 'VALIDATION_ERROR') {
        return {
          success: false,
          message: 'Error de validaciÃ³n',
          details: data.details
        };
      }
      
      return {
        success: false,
        message: data.message || 'Error desconocido'
      };
    }
    
    // Error de red
    return {
      success: false,
      message: 'Error de conexiÃ³n. Intenta nuevamente.'
    };
  }
}
```

---

## ğŸ§ª TESTING

### Pruebas con cURL

```bash
# 1. Health check
curl https://app1.intercapital.ar/api/chatbot/health

# 2. Validar usuario
curl -H "x-api-key: YOUR_API_KEY" \
  "https://app1.intercapital.ar/api/chatbot/usuarios/validate?comitente=12345"

# 3. Crear orden
curl -X POST https://app1.intercapital.ar/api/chatbot/ordenes \
  -H "Content-Type: application/json" \
  -H "x-api-key: YOUR_API_KEY" \
  -d '{
    "comitente": 12345,
    "operacion": "COMPRA",
    "symbol": "AL30",
    "cantidad": 100,
    "precio": 850.50,
    "plazo": "CONTADO",
    "tipo_orden": "MERCADO",
    "notas": "Orden de prueba desde cURL",
    "metadata": {
      "whatsapp_phone": "+5491112345678",
      "conversation_id": "test_123"
    }
  }'

# 4. Consultar orden (reemplazar UUID)
curl -H "x-api-key: YOUR_API_KEY" \
  "https://app1.intercapital.ar/api/chatbot/ordenes/UUID_DE_LA_ORDEN"

# 5. Listar Ã³rdenes
curl -H "x-api-key: YOUR_API_KEY" \
  "https://app1.intercapital.ar/api/chatbot/ordenes?comitente=12345&estado=PENDIENTE&limit=10"
```

---

## ğŸ› ï¸ GESTIÃ“N DE API KEYS

### Listar API Keys Existentes

```bash
cd /var/www/intercapital/back
node src/scripts/list-chatbot-apikeys.js
```

### Crear Nueva API Key

```bash
cd /var/www/intercapital/back
node src/scripts/create-chatbot-apikey.js
```

Para crear con configuraciÃ³n personalizada, edita el archivo antes de ejecutar.

### Revocar API Key

```bash
cd /var/www/intercapital/back
node src/scripts/revoke-chatbot-apikey.js <KEY_ID>
```

---

## ğŸ“Š MONITOREO Y LOGS

### Ver Logs del Backend

```bash
# Logs en tiempo real
pm2 logs intercapital-new-api

# Ãšltimas 100 lÃ­neas
pm2 logs intercapital-new-api --lines 100

# Filtrar logs del chatbot
pm2 logs intercapital-new-api | grep chatbot
```

### Consultar Logs en Base de Datos

```sql
-- Ãšltimos 100 requests del chatbot
SELECT 
  api_key_name,
  method,
  endpoint,
  status_code,
  duration_ms,
  created_at
FROM chatbot_logs
ORDER BY created_at DESC
LIMIT 100;

-- Requests con error
SELECT *
FROM chatbot_logs
WHERE status_code >= 400
ORDER BY created_at DESC
LIMIT 50;

-- EstadÃ­sticas por API key
SELECT 
  api_key_name,
  COUNT(*) as total_requests,
  AVG(duration_ms) as avg_duration,
  COUNT(CASE WHEN status_code >= 400 THEN 1 END) as errors
FROM chatbot_logs
WHERE created_at >= NOW() - INTERVAL '24 hours'
GROUP BY api_key_name;
```

---

## âš ï¸ CONSIDERACIONES IMPORTANTES

### Seguridad

1. **Nunca** expongas la API key en cÃ³digo pÃºblico
2. Usa variables de entorno en Render
3. Rota las API keys cada 90 dÃ­as
4. Monitorea los logs regularmente

### Performance

1. Implementa cachÃ© en el bot para datos que no cambian frecuentemente
2. Usa el rate limiting de manera inteligente
3. Implementa retry con backoff exponencial

### Manejo de Errores

1. Siempre valida el usuario antes de crear Ã³rdenes
2. Maneja todos los cÃ³digos de error posibles
3. Proporciona mensajes claros al usuario final

### AuditorÃ­a

1. Todos los requests se loguean automÃ¡ticamente
2. Incluye metadata Ãºtil en cada request
3. Los logs se retienen por 90 dÃ­as

---

## ğŸ¯ CHECKLIST DE GO-LIVE

### Pre-ProducciÃ³n
- [ ] Backend reiniciado con nuevos cambios
- [ ] Tablas creadas en base de datos
- [ ] API key generada y guardada de forma segura
- [ ] Health check funcionando
- [ ] Pruebas con cURL exitosas

### ConfiguraciÃ³n Render
- [ ] Variables de entorno configuradas
- [ ] INTERCAPITAL_API_URL correcta
- [ ] INTERCAPITAL_API_KEY configurada
- [ ] Servicio reiniciado

### Testing
- [ ] ValidaciÃ³n de usuario funciona
- [ ] CreaciÃ³n de orden funciona
- [ ] Consulta de orden funciona
- [ ] Listado de Ã³rdenes funciona
- [ ] Manejo de errores correcto

### Monitoreo
- [ ] Logs del backend monitoreados
- [ ] Logs del chatbot en Render monitoreados
- [ ] Alertas configuradas (opcional)

---

## ğŸ“ SOPORTE

### Problemas Comunes

**1. Error 401: API_KEY_MISSING**
- Verifica que el header `x-api-key` estÃ© presente
- Verifica que la variable de entorno estÃ© configurada en Render

**2. Error 401: INVALID_API_KEY**
- Verifica que la API key sea correcta
- Verifica que la API key no haya sido revocada
- Genera una nueva API key si es necesario

**3. Error 429: RATE_LIMIT_EXCEEDED**
- Espera 60 segundos antes de reintentar
- Implementa backoff exponencial
- Considera solicitar aumento de lÃ­mite

**4. Error 400: VALIDATION_ERROR**
- Revisa los campos requeridos
- Verifica los formatos de datos
- Lee el campo `details` para mÃ¡s informaciÃ³n

**5. Error 404: USER_NOT_FOUND**
- Verifica que el comitente exista
- Verifica que el comitente estÃ© activo

---

## ğŸš€ PRÃ“XIMOS PASOS

1. **Inmediato:** Desplegar y probar en producciÃ³n
2. **Corto plazo:** Implementar webhooks para notificaciones
3. **Mediano plazo:** Agregar mÃ¡s endpoints (aprobar/rechazar Ã³rdenes)
4. **Largo plazo:** Dashboard de mÃ©tricas en tiempo real

---

## âœ… CONCLUSIÃ“N

La API del chatbot estÃ¡ **100% funcional** y lista para producciÃ³n. Sigue los pasos de este documento para:

1. âœ… Desplegar en el VPS
2. âœ… Configurar en Render
3. âœ… Integrar con el chatbot de WhatsApp
4. âœ… Monitorear y mantener

**Tiempo estimado de configuraciÃ³n:** 30-60 minutos

**Â¿Dudas o problemas?** Revisa la secciÃ³n de Soporte o consulta los logs.
